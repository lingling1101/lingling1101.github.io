<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Data Sharing :: WORK WITH AMAZON SYSTEM MANAGER - SESSION MANAGER</title>

    
    <link href="/css/nucleus.css?1725803905" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1725803905" rel="stylesheet">
    <link href="/css/hybrid.css?1725803905" rel="stylesheet">
    <link href="/css/featherlight.min.css?1725803905" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1725803905" rel="stylesheet">
    <link href="/css/auto-complete.css?1725803905" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1725803905" rel="stylesheet">
    <link href="/css/theme.css?1725803905" rel="stylesheet">
    <link href="/css/hugo-theme.css?1725803905" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1725803905" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1725803905"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/4-data-sharing/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1725803905"></script>
<script type="text/javascript" src="/js/auto-complete.js?1725803905"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/lingling1101.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1725803905"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/1-getting-started/">
           <b> 1. </b> Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-table-design-and-load/" title="Table Design and Load" class="dd-item 
        
        
        
        ">
      <a href="/2-table-design-and-load/">
           <b> 2. </b> Table Design and Load
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-ongoing-load---elt/" title="Ongoing Load - ELT" class="dd-item 
        
        
        
        ">
      <a href="/3-ongoing-load---elt/">
           <b> 3. </b> Ongoing Load - ELT
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-data-sharing/" title="Data Sharing" class="dd-item 
        
        active
        
        ">
      <a href="/4-data-sharing/">
           <b> 4. </b> Data Sharing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-machine-learning---redshift-ml/" title="Machine Learning - Redshift ML" class="dd-item 
        
        
        
        ">
      <a href="/5-machine-learning---redshift-ml/">
           <b> 5. </b> Machine Learning - Redshift ML
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-query-data-lake---redshift-spectrum/" title="Query Data Lake - Redshift Spectrum" class="dd-item 
        
        
        
        ">
      <a href="/6-query-data-lake---redshift-spectrum/">
           <b> 6. </b> Query Data Lake - Redshift Spectrum
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-operations/" title="Operations" class="dd-item 
        
        
        
        ">
      <a href="/7-operations/">
           <b> 7. </b> Operations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/8-clean/" title="Clean up resources" class="dd-item 
        
        
        
        ">
      <a href="/8-clean/">
           <b> 8. </b> Clean up resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://aws.amazon.com/blogs"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://lingling1101.github.io/4-data-sharing/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://lingling1101.github.io/vi/4-data-sharing/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>31-08-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://drive.google.com/drive/folders/1-JDjxDuFFq9Xwszz7REZ_kDzWDPtM1XS?usp=sharing"  style="color:orange">Nguyễn Thị Thùy Linh  </a> <br>
                
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>Redshift Immersion Labs</a> > Data Sharing
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Data Sharing
            </h1>
          

        



	<p><strong>4. Data Sharing</strong></p>
<p>In this lab, you will walk through steps for data sharing between a serverless endpoint and a provisioned cluster.</p>
<p><strong>Contents</strong></p>
<ul>
<li>Before you begin</li>
<li>Introduction</li>
<li>Identify namespaces</li>
<li>Create data share on producer</li>
<li>Query data from consumer</li>
<li>Create external schema in consumer</li>
<li>Load local data and join to shared data</li>
<li>Before you leave</li>
</ul>
<p><strong>4.1 Before you begin</strong></p>
<p>This lab assumes that you have launched an Amazon Redshift Serverless endpoint and Provisioned cluster. If you have not already done so, please see <a href="https://catalog.us-east-1.prod.workshops.aws/workshops/9f29cdba-66c0-445e-8cbb-28a092cb5ba7/en-US/lab1"><strong>Getting Started</strong></a> and follow the instructions there. We will use <a href="https://console.aws.amazon.com/sqlworkbench/home">Amazon Redshift QueryEditorV2</a>  for this lab.</p>
<p><strong>4.2 Introduction</strong></p>
<p><strong>A datashare</strong> <em>is the unit of sharing data in Amazon Redshift. Use datashares to share data in the same AWS account or different AWS accounts. Also, share data for read purposes across different Amazon Redshift clusters. Each datashare is associated with a specific database in your Amazon Redshift cluster.</em></p>
<p><em>Datashare objects are objects from specific databases on a cluster that producer cluster administrators can add to datashares to be shared with data consumers. Datashare objects are read-only for data consumers. Examples of datashare objects are tables, views, and user-defined functions. You can add datashare objects to datashares while creating datashares or editing a datashare at any time.</em></p>
<p><strong>Reference:</strong> <a href="https://aws.amazon.com/redshift/features/data-sharing/">Amazon Redshift Data Sharing</a></p>
<p><strong>4.3 Identify namespaces</strong></p>
<p>We will run simple SQL statements to find the namespace for both producer cluster and consumer cluster. These values will be used in subsequent instructions.</p>
<p><strong>NOTE:</strong> namespace is globally unique identifier (GUID) automatically created during Amazon Redshift cluster creation and attached to the cluster. It is used to uniquely reference the Redshift cluster.</p>
<p>Run following command in query editor connecting to serverless endpoint (producer - Serverless: workgroup-xxxxxxx). Note down the namespace from output. Ensure that the editor is connected to the producer cluster.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">This</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">producer</span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#a6e22e">current_namespace</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-01.png"></p>
<p>Run following command in query editor connecting to the provisioned cluster (consumer - consumercluster-xxxxxxxxxx). Note down the namespace from output. Ensure that the editor is connected to the consumer cluster.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">This</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">consumer</span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#a6e22e">current_namespace</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-012.png"></p>
<p><strong>4.4 Create data share on producer</strong></p>
<p>Run following commands connecting to the serverless endpoint (producer - Serverless: workgroup-xxxxxxx) to create a data share and add <code>customer</code> table to data share.</p>
<p>Replace <code>&lt;&lt;consumer namespace&gt;&gt;</code> with the consumer cluster namespace captured begining of this lab.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Creating</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">datashare</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">DATASHARE</span> <span style="color:#a6e22e">cust_share</span> <span style="color:#a6e22e">SET</span> <span style="color:#a6e22e">PUBLICACCESSIBLE</span> <span style="color:#a6e22e">TRUE</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Adding</span> <span style="color:#a6e22e">schema</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">datashare</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ALTER</span> <span style="color:#a6e22e">DATASHARE</span> <span style="color:#a6e22e">cust_share</span> <span style="color:#a6e22e">ADD</span> <span style="color:#a6e22e">SCHEMA</span> <span style="color:#66d9ef">public</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Adding</span> <span style="color:#a6e22e">customer</span> <span style="color:#a6e22e">tables</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">datshares</span>.  <span style="color:#a6e22e">We</span> <span style="color:#a6e22e">can</span> <span style="color:#a6e22e">add</span> <span style="color:#a6e22e">all</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">tables</span> <span style="color:#a6e22e">also</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">required</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ALTER</span> <span style="color:#a6e22e">DATASHARE</span> <span style="color:#a6e22e">cust_share</span> <span style="color:#a6e22e">ADD</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#66d9ef">public</span>.<span style="color:#a6e22e">customer</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">View</span> <span style="color:#a6e22e">shared</span> <span style="color:#a6e22e">objects</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">show</span> <span style="color:#a6e22e">datashares</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">SVV_DATASHARE_OBJECTS</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Granting</span> <span style="color:#a6e22e">access</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">consumer</span> <span style="color:#a6e22e">cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Grant</span> <span style="color:#a6e22e">USAGE</span> <span style="color:#a6e22e">ON</span> <span style="color:#a6e22e">DATASHARE</span> <span style="color:#a6e22e">cust_share</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">NAMESPACE</span> <span style="color:#e6db74">&#39;&lt;&lt;consumer namespace&gt;&gt;&#39;</span>
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-04.png"></p>
<p><strong>4.5 Query data from consumer</strong></p>
<p>Please run following commands in the provisioned cluster (consumer - consumercluster-xxxxxxxxxx) to create a local database on shared data.</p>
<p><strong>NOTE:</strong> Replace <code>&lt;&lt;producer namespace&gt;&gt;</code> with the producer namespace captured begining of this lab.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">View</span> <span style="color:#a6e22e">shared</span> <span style="color:#a6e22e">objects</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">show</span> <span style="color:#a6e22e">datashares</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">SVV_DATASHARE_OBJECTS</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">local</span> <span style="color:#a6e22e">database</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">DATABASE</span> <span style="color:#a6e22e">cust_db</span> <span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">DATASHARE</span> <span style="color:#a6e22e">cust_share</span> <span style="color:#a6e22e">OF</span> <span style="color:#a6e22e">NAMESPACE</span> <span style="color:#e6db74">&#39;&lt;&lt;producer namespace&gt;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Select</span> <span style="color:#a6e22e">query</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">check</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">count</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">cust_db</span>.<span style="color:#66d9ef">public</span>.<span style="color:#a6e22e">customer</span>; <span style="color:#f92672">--</span> <span style="color:#a6e22e">count</span> <span style="color:#ae81ff">15000000</span>
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-05.png"></p>
<h4 id="optional">[OPTIONAL]</h4>
<p><strong>- Create external schema in consumer</strong></p>
<p>Running the following command in the provisioned consumer cluster (consumer - consumercluster-xxxxxxxxxx) will create an external schema called cust_db_public in your consumer&rsquo;s dev database. This is useful when you require all of your data to be available in a single database, simplifying SQL statements to use two-dot notation instead of three-dot (as shown in the next step). This step is also necessary when using some BI tools to allow metadata to be correctly refreshed in their UI. Creating an external schema using a datashare object can also simplify the process of splitting workloads to datasharing clusters. By creating external schemas in your consumer cluster with the same name as in the producer, workload queries can be migrated to the consumer cluster without needing any change.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">local</span> <span style="color:#a6e22e">schema</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">EXTERNAL</span> <span style="color:#a6e22e">SCHEMA</span> <span style="color:#a6e22e">cust_db_public</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">REDSHIFT</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">DATABASE</span> <span style="color:#e6db74">&#39;cust_db&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SCHEMA</span> <span style="color:#e6db74">&#39;public&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Select</span> <span style="color:#a6e22e">query</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">check</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">count</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">cust_db_public</span>.<span style="color:#a6e22e">customer</span>; <span style="color:#f92672">--</span> <span style="color:#a6e22e">count</span> <span style="color:#ae81ff">15000000</span>
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-6.png"></p>
<p><strong>Notice:</strong> you get the same results as in the previous step, but the select statement is using the new external schema.</p>
<p><strong>- Load local data and join to shared data</strong></p>
<p>Run following commands in a query editor tab that is to the provisioned cluster (consumer - consumercluster-xxxxxxxxxx). The following commands are used to create and load orders table data that will be later joined with customer data shared from the producer endpoint.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Create</span> <span style="color:#a6e22e">orders</span> <span style="color:#a6e22e">table</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">provisioned</span> <span style="color:#a6e22e">cluster</span> (<span style="color:#a6e22e">consumer</span>).
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">DROP</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#a6e22e">IF</span> <span style="color:#a6e22e">EXISTS</span> <span style="color:#a6e22e">orders</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">create</span> <span style="color:#a6e22e">table</span> <span style="color:#a6e22e">orders</span>
</span></span><span style="display:flex;"><span>(  <span style="color:#a6e22e">O_ORDERKEY</span> <span style="color:#a6e22e">bigint</span> <span style="color:#a6e22e">NOT</span> <span style="color:#a6e22e">NULL</span>,  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">O_CUSTKEY</span> <span style="color:#a6e22e">bigint</span>,  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">O_ORDERSTATUS</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">1</span>),  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">O_TOTALPRICE</span> <span style="color:#a6e22e">decimal</span>(<span style="color:#ae81ff">18</span>,<span style="color:#ae81ff">4</span>),  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">O_ORDERDATE</span> Date,  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">O_ORDERPRIORITY</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">15</span>),  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">O_CLERK</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">15</span>),  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">O_SHIPPRIORITY</span> <span style="color:#a6e22e">Integer</span>,  <span style="color:#a6e22e">O_COMMENT</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">79</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">distkey</span> (<span style="color:#a6e22e">O_ORDERKEY</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sortkey</span> (<span style="color:#a6e22e">O_ORDERDATE</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Load</span> <span style="color:#a6e22e">orders</span> <span style="color:#a6e22e">table</span> <span style="color:#a6e22e">from</span> <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">set</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">copy</span> <span style="color:#a6e22e">orders</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;s3://redshift-immersionday-labs/data/orders/orders.tbl.&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">iam_role</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">region</span> <span style="color:#e6db74">&#39;us-west-2&#39;</span> <span style="color:#a6e22e">lzop</span> <span style="color:#a6e22e">delimiter</span> <span style="color:#e6db74">&#39;|&#39;</span> <span style="color:#a6e22e">COMPUPDATE</span> <span style="color:#a6e22e">PRESET</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Select</span> <span style="color:#a6e22e">count</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">verify</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">load</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#a6e22e">count</span>(<span style="color:#f92672">*</span>) <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">orders</span>;  <span style="color:#f92672">--</span> <span style="color:#a6e22e">count</span> <span style="color:#ae81ff">76000000</span>
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-7.png"></p>
<p>Run the below BI query to find total sale price by customer segment and order priority joining locally loaded order data to shared customer data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">c_mktsegment</span>, <span style="color:#a6e22e">o_orderpriority</span>, <span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">o_totalprice</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">cust_db</span>.<span style="color:#66d9ef">public</span>.<span style="color:#a6e22e">customer</span> <span style="color:#a6e22e">c</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">JOIN</span> <span style="color:#a6e22e">orders</span> <span style="color:#a6e22e">o</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">c_custkey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">o_custkey</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">GROUP</span> <span style="color:#a6e22e">BY</span> <span style="color:#a6e22e">c_mktsegment</span>, <span style="color:#a6e22e">o_orderpriority</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-8.png"></p>
<p>If you created the external schema in the previous step, run the below query using the local schema instead of the datashare database. This will provide the same result as the query above.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">c_mktsegment</span>, <span style="color:#a6e22e">o_orderpriority</span>, <span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">o_totalprice</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">cust_db_public</span>.<span style="color:#a6e22e">customer</span> <span style="color:#a6e22e">c</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">JOIN</span> <span style="color:#a6e22e">orders</span> <span style="color:#a6e22e">o</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">c_custkey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">o_custkey</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">GROUP</span> <span style="color:#a6e22e">BY</span> <span style="color:#a6e22e">c_mktsegment</span>, <span style="color:#a6e22e">o_orderpriority</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/4/4-9.png"></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/3-ongoing-load---elt/" title="Ongoing Load - ELT"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/5-machine-learning---redshift-ml/" title="Machine Learning - Redshift ML" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1725803905"></script>
    <script src="/js/perfect-scrollbar.min.js?1725803905"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1725803905"></script>
    <script src="/js/jquery.sticky.js?1725803905"></script>
    <script src="/js/featherlight.min.js?1725803905"></script>
    <script src="/js/highlight.pack.js?1725803905"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1725803905"></script>
    <script src="/js/learn.js?1725803905"></script>
    <script src="/js/hugo-learn.js?1725803905"></script>

    <link href="/mermaid/mermaid.css?1725803905" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1725803905"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
