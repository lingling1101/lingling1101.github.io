<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Machine Learning - Redshift ML :: WORK WITH AMAZON SYSTEM MANAGER - SESSION MANAGER</title>

    
    <link href="/css/nucleus.css?1725803905" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1725803905" rel="stylesheet">
    <link href="/css/hybrid.css?1725803905" rel="stylesheet">
    <link href="/css/featherlight.min.css?1725803905" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1725803905" rel="stylesheet">
    <link href="/css/auto-complete.css?1725803905" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1725803905" rel="stylesheet">
    <link href="/css/theme.css?1725803905" rel="stylesheet">
    <link href="/css/hugo-theme.css?1725803905" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1725803905" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1725803905"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/5-machine-learning---redshift-ml/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1725803905"></script>
<script type="text/javascript" src="/js/auto-complete.js?1725803905"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/lingling1101.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1725803905"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/1-getting-started/">
           <b> 1. </b> Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-table-design-and-load/" title="Table Design and Load" class="dd-item 
        
        
        
        ">
      <a href="/2-table-design-and-load/">
           <b> 2. </b> Table Design and Load
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-ongoing-load---elt/" title="Ongoing Load - ELT" class="dd-item 
        
        
        
        ">
      <a href="/3-ongoing-load---elt/">
           <b> 3. </b> Ongoing Load - ELT
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-data-sharing/" title="Data Sharing" class="dd-item 
        
        
        
        ">
      <a href="/4-data-sharing/">
           <b> 4. </b> Data Sharing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-machine-learning---redshift-ml/" title="Machine Learning - Redshift ML" class="dd-item 
        
        active
        
        ">
      <a href="/5-machine-learning---redshift-ml/">
           <b> 5. </b> Machine Learning - Redshift ML
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-query-data-lake---redshift-spectrum/" title="Query Data Lake - Redshift Spectrum" class="dd-item 
        
        
        
        ">
      <a href="/6-query-data-lake---redshift-spectrum/">
           <b> 6. </b> Query Data Lake - Redshift Spectrum
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-operations/" title="Operations" class="dd-item 
        
        
        
        ">
      <a href="/7-operations/">
           <b> 7. </b> Operations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/8-clean/" title="Clean up resources" class="dd-item 
        
        
        
        ">
      <a href="/8-clean/">
           <b> 8. </b> Clean up resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://aws.amazon.com/blogs"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://lingling1101.github.io/5-machine-learning---redshift-ml/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://lingling1101.github.io/vi/5-machine-learning---redshift-ml/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>31-08-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://drive.google.com/drive/folders/1-JDjxDuFFq9Xwszz7REZ_kDzWDPtM1XS?usp=sharing"  style="color:orange">Nguyễn Thị Thùy Linh  </a> <br>
                
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>Redshift Immersion Labs</a> > Machine Learning - Redshift ML
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Machine Learning - Redshift ML
            </h1>
          

        



	<p><strong>5. Machine Learning - Redshift ML</strong></p>
<p>In this lab you will create a model using Redshift ML Auto.</p>
<p><strong>Contents</strong></p>
<ul>
<li>Before you begin</li>
<li>Data preparation</li>
<li>Create model</li>
<li>Check accuracy and run inference query</li>
<li>Explainability</li>
<li>Before you leave</li>
</ul>
<p><strong>5.1 Before you begin</strong></p>
<p>This lab assumes that you have launched an Amazon Redshift Serverless endpoint. If you have not already done so, please see <a href="https://catalog.us-east-1.prod.workshops.aws/workshops/9f29cdba-66c0-445e-8cbb-28a092cb5ba7/en-US/lab1"><strong>Getting Started</strong></a> and follow the instructions there. We will use <a href="https://console.aws.amazon.com/sqlworkbench/home">Amazon Redshift QueryEditorV2</a>  for this lab.</p>
<p><strong>5.2 Data preparation</strong></p>
<p>The Bank Marketing data set contains direct marketing campaigns of a Portuguese banking institution. The marketing campaigns were based on phone calls. Often, more than one contact to the same client was required, in order to assess (evaluate) if the product (bank term deposit) would be (&lsquo;yes&rsquo;) or not (&rsquo;no&rsquo;) subscribed.</p>
<p>The data set consists of the following attributes. The classification goal is to predict if the client will subscribe to a term deposit.</p>
<p><strong>Attributes for bank client data:</strong></p>
<ul>
<li>age (numeric)</li>
<li>jobtype</li>
<li>marital</li>
<li>education</li>
<li>default</li>
<li>housing</li>
<li>loan</li>
<li>contact</li>
<li>month</li>
<li>day_of_week</li>
<li>duration</li>
<li>campaign</li>
<li>pdays</li>
<li>previous</li>
<li>poutcome</li>
<li>emp.var.rate</li>
<li>cons.price.idx</li>
<li>cons.conf.idx</li>
<li>euribor3m</li>
<li>nr.employed</li>
</ul>
<p><strong>Reference:</strong> <a href="https://archive.ics.uci.edu/ml/datasets/bank+marketing">Amazon Redshift Data Sharing</a></p>
<p>Execute the following statements to create and load the training table in Redshift. Note the additional field y which will contain yes or no indicating the result of the term deposit subscription. The training data will be loaded with historical data and is used to create the model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#a6e22e">bank_details_training</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">age</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">jobtype</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">marital</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">education</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;default&#34;</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">housing</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">loan</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">contact</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">month</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">day_of_week</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">duration</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">campaign</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">pdays</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">previous</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">poutcome</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">emp_var_rate</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cons_price_idx</span> <span style="color:#a6e22e">numeric</span>,     
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cons_conf_idx</span> <span style="color:#a6e22e">numeric</span>,     
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">euribor3m</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">nr_employed</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">boolean</span> ) ;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">COPY</span> <span style="color:#a6e22e">bank_details_training</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;s3://redshift-downloads/redshift-ml/workshop/bank-marketing-data/training_data/&#39;</span> <span style="color:#a6e22e">REGION</span> <span style="color:#e6db74">&#39;us-east-1&#39;</span> <span style="color:#a6e22e">IAM_ROLE</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">CSV</span> <span style="color:#a6e22e">IGNOREHEADER</span> <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">delimiter</span> <span style="color:#e6db74">&#39;;&#39;</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/5/5-01.png"></p>
<p>Execute the following statements to create and load the inference table in Redshift. This data will be used to simulate new data which we can test against the model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#a6e22e">bank_details_inference</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">age</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">jobtype</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">marital</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">education</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;default&#34;</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">housing</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">loan</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">contact</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">month</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">day_of_week</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">duration</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">campaign</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">pdays</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">previous</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">poutcome</span> <span style="color:#a6e22e">varchar</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">emp_var_rate</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cons_price_idx</span> <span style="color:#a6e22e">numeric</span>,     
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cons_conf_idx</span> <span style="color:#a6e22e">numeric</span>,     
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">euribor3m</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">nr_employed</span> <span style="color:#a6e22e">numeric</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">boolean</span> ) ;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">COPY</span> <span style="color:#a6e22e">bank_details_inference</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;s3://redshift-downloads/redshift-ml/workshop/bank-marketing-data/inference_data/&#39;</span> <span style="color:#a6e22e">REGION</span> <span style="color:#e6db74">&#39;us-east-1&#39;</span> <span style="color:#a6e22e">IAM_ROLE</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">CSV</span> <span style="color:#a6e22e">IGNOREHEADER</span> <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">delimiter</span> <span style="color:#e6db74">&#39;;&#39;</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/5/5-02.png"></p>
<p><strong>Create S3 bucket</strong></p>
<p>Before you create a model, you need to create a S3 bucket for storing intermediate results. Navigate to S3 and create a testanalytics bucket suffixed with your name, a random number, or you account number to give a unique name. You can find your account number on top right hand corner of management console. The intention is to create a S3 bucket with unique name.</p>
<p><img alt="image.png" src="/images/5/5-3.png"></p>
<p><img alt="image.png" src="/images/5/5-04.png"></p>
<p><strong>5.3 Create model</strong></p>
<p>Complete Autopilot generated with minimal user inputs. This will be a binary classification problem but auto pilot will choose the relevant algorithm based on the data and inputs</p>
<p>Execute the following statement to create the model. Replace <code>&lt;&lt;S3 bucket&gt;&gt;</code> with the bucket name you created above.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">DROP</span> <span style="color:#a6e22e">MODEL</span> <span style="color:#a6e22e">model_bank_marketing</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">MODEL</span> <span style="color:#a6e22e">model_bank_marketing</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> (
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span>    
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">age</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">jobtype</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">marital</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">education</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;default&#34;</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">housing</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">loan</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">contact</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">month</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">day_of_week</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">duration</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">campaign</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">pdays</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">previous</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">poutcome</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">emp_var_rate</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cons_price_idx</span> ,     
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">cons_conf_idx</span> ,     
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">euribor3m</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">nr_employed</span> ,
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">y</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bank_details_training</span> )
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">TARGET</span> <span style="color:#a6e22e">y</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FUNCTION</span> <span style="color:#a6e22e">func_model_bank_marketing</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">IAM_ROLE</span> <span style="color:#66d9ef">default</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SETTINGS</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">S3_BUCKET</span> <span style="color:#e6db74">&#39;&lt;&lt;S3 bucket&gt;&gt;&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">MAX_RUNTIME</span> <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/5/5-5.png"></p>
<p>Run following command to check status of the model. It will be in TRAINING state. The create model will take ~ 60 minutes to run.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">show</span> <span style="color:#a6e22e">model</span> <span style="color:#a6e22e">model_bank_marketing</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/5/5-06.png"></p>
<blockquote>
<p>As the training takes ~60minutes, you can move to next lab or a presentation. Please come back after an hour and execute rest of the steps.</p>
</blockquote>
<p><strong>5.4 Check accuracy and run inference query</strong></p>
<p>Hope you gave enough time (~60min) for model to complete training. Run the same SQL Query as above to check status of the model. The model state should be in &lsquo;Ready&rsquo; for you to proceed. Pay attention to the validation:f1 score - it will be between 0 and 1, the closer to 1, the better the model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">show</span> <span style="color:#a6e22e">model</span> <span style="color:#a6e22e">model_bank_marketing</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/5/5-07.png"></p>
<p>Check Inference/Accuracy of the model. Run the following queries - the first checks the accuracy of the model and the second will use the function created by the pre built model for the inference and against the data set in inference table bank_details_inference.</p>
<pre tabindex="0"><code>bank_details_inference
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">Inference</span><span style="color:#f92672">/</span><span style="color:#a6e22e">Accuracy</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">inference</span> <span style="color:#a6e22e">data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WITH</span> <span style="color:#a6e22e">infer_data</span>
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">AS</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SELECT</span>  <span style="color:#a6e22e">y</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">actual</span>, <span style="color:#a6e22e">func_model_bank_marketing</span>(<span style="color:#a6e22e">age</span>,<span style="color:#a6e22e">jobtype</span>,<span style="color:#a6e22e">marital</span>,<span style="color:#a6e22e">education</span>,<span style="color:#e6db74">&#34;default&#34;</span>,<span style="color:#a6e22e">housing</span>,<span style="color:#a6e22e">loan</span>,<span style="color:#a6e22e">contact</span>,<span style="color:#a6e22e">month</span>,<span style="color:#a6e22e">day_of_week</span>,<span style="color:#a6e22e">duration</span>,<span style="color:#a6e22e">campaign</span>,<span style="color:#a6e22e">pdays</span>,<span style="color:#a6e22e">previous</span>,<span style="color:#a6e22e">poutcome</span>,<span style="color:#a6e22e">emp_var_rate</span>,<span style="color:#a6e22e">cons_price_idx</span>,<span style="color:#a6e22e">cons_conf_idx</span>,<span style="color:#a6e22e">euribor3m</span>,<span style="color:#a6e22e">nr_employed</span>) <span style="color:#a6e22e">AS</span> <span style="color:#a6e22e">predicted</span>,
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">CASE</span> <span style="color:#a6e22e">WHEN</span> <span style="color:#a6e22e">actual</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">predicted</span> <span style="color:#a6e22e">THEN</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">::</span><span style="color:#a6e22e">INT</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">ELSE</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">::</span><span style="color:#a6e22e">INT</span> <span style="color:#a6e22e">END</span> <span style="color:#a6e22e">AS</span> <span style="color:#a6e22e">correct</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">bank_details_inference</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">aggr_data</span> <span style="color:#a6e22e">AS</span> (
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">SUM</span>(<span style="color:#a6e22e">correct</span>) <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">num_correct</span>, <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">total</span> <span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">infer_data</span>
</span></span><span style="display:flex;"><span> )
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">SELECT</span> (<span style="color:#a6e22e">num_correct</span><span style="color:#f92672">::</span><span style="color:#66d9ef">float</span><span style="color:#f92672">/</span><span style="color:#a6e22e">total</span><span style="color:#f92672">::</span><span style="color:#66d9ef">float</span>) <span style="color:#a6e22e">AS</span> <span style="color:#a6e22e">accuracy</span> <span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">aggr_data</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">Predict</span> <span style="color:#a6e22e">how</span> <span style="color:#a6e22e">many</span> <span style="color:#a6e22e">will</span> <span style="color:#a6e22e">subscribe</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">term</span> <span style="color:#a6e22e">deposit</span> <span style="color:#a6e22e">vs</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">subscribe</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WITH</span> <span style="color:#a6e22e">term_data</span> <span style="color:#a6e22e">AS</span> ( <span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">func_model_bank_marketing</span>( <span style="color:#a6e22e">age</span>,<span style="color:#a6e22e">jobtype</span>,<span style="color:#a6e22e">marital</span>,<span style="color:#a6e22e">education</span>,<span style="color:#e6db74">&#34;default&#34;</span>,<span style="color:#a6e22e">housing</span>,<span style="color:#a6e22e">loan</span>,<span style="color:#a6e22e">contact</span>,<span style="color:#a6e22e">month</span>,<span style="color:#a6e22e">day_of_week</span>,<span style="color:#a6e22e">duration</span>,<span style="color:#a6e22e">campaign</span>,<span style="color:#a6e22e">pdays</span>,<span style="color:#a6e22e">previous</span>,<span style="color:#a6e22e">poutcome</span>,<span style="color:#a6e22e">emp_var_rate</span>,<span style="color:#a6e22e">cons_price_idx</span>,<span style="color:#a6e22e">cons_conf_idx</span>,<span style="color:#a6e22e">euribor3m</span>,<span style="color:#a6e22e">nr_employed</span>) <span style="color:#a6e22e">AS</span> <span style="color:#a6e22e">predicted</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">bank_details_inference</span> )
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CASE</span> <span style="color:#a6e22e">WHEN</span> <span style="color:#a6e22e">predicted</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Y&#39;</span>  <span style="color:#a6e22e">THEN</span> <span style="color:#e6db74">&#39;Yes-will-do-a-term-deposit&#39;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">WHEN</span> <span style="color:#a6e22e">predicted</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;N&#39;</span>  <span style="color:#a6e22e">THEN</span> <span style="color:#e6db74">&#39;No-term-deposit&#39;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a6e22e">ELSE</span> <span style="color:#e6db74">&#39;Neither&#39;</span> <span style="color:#a6e22e">END</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">deposit_prediction</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">COUNT</span>(<span style="color:#ae81ff">1</span>) <span style="color:#a6e22e">AS</span> <span style="color:#a6e22e">count</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">from</span> <span style="color:#a6e22e">term_data</span> <span style="color:#a6e22e">GROUP</span> <span style="color:#a6e22e">BY</span> <span style="color:#ae81ff">1</span>;.
</span></span></code></pre></div><p><img alt="image.png" src="/images/5/5-8.png"></p>
<p><img alt="image.png" src="/images/5/5-9.png"></p>
<p><strong>5.5 Explainability</strong></p>
<p>You can identify which attributes are positively contributing to the prediction and how much is the contribution score by generating model explainability report. Please run below command to see model explainability.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">explain_model</span>(<span style="color:#e6db74">&#39;model_bank_marketing&#39;</span>);
</span></span></code></pre></div><p><img alt="image.png" src="/images/5/5-010.png"></p>
<p>You will get a message stating that model did not train long enough to generate explainability report. That is expected as the model trained with MAX_RUNTIME of 3600 seconds. Usually you should increase the <code>MAX_RUNTIME</code> to 9600 or above for Redshift to generate explainability report. That gives enough to complete the explainability report steps model training.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/4-data-sharing/" title="Data Sharing"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/6-query-data-lake---redshift-spectrum/" title="Query Data Lake - Redshift Spectrum" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1725803905"></script>
    <script src="/js/perfect-scrollbar.min.js?1725803905"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1725803905"></script>
    <script src="/js/jquery.sticky.js?1725803905"></script>
    <script src="/js/featherlight.min.js?1725803905"></script>
    <script src="/js/highlight.pack.js?1725803905"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1725803905"></script>
    <script src="/js/learn.js?1725803905"></script>
    <script src="/js/hugo-learn.js?1725803905"></script>

    <link href="/mermaid/mermaid.css?1725803905" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1725803905"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
