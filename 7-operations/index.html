<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Operations :: WORK WITH AMAZON SYSTEM MANAGER - SESSION MANAGER</title>

    
    <link href="/css/nucleus.css?1725803905" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1725803905" rel="stylesheet">
    <link href="/css/hybrid.css?1725803905" rel="stylesheet">
    <link href="/css/featherlight.min.css?1725803905" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1725803905" rel="stylesheet">
    <link href="/css/auto-complete.css?1725803905" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1725803905" rel="stylesheet">
    <link href="/css/theme.css?1725803905" rel="stylesheet">
    <link href="/css/hugo-theme.css?1725803905" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1725803905" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1725803905"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/7-operations/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1725803905"></script>
<script type="text/javascript" src="/js/auto-complete.js?1725803905"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/lingling1101.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1725803905"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/1-getting-started/">
           <b> 1. </b> Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-table-design-and-load/" title="Table Design and Load" class="dd-item 
        
        
        
        ">
      <a href="/2-table-design-and-load/">
           <b> 2. </b> Table Design and Load
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-ongoing-load---elt/" title="Ongoing Load - ELT" class="dd-item 
        
        
        
        ">
      <a href="/3-ongoing-load---elt/">
           <b> 3. </b> Ongoing Load - ELT
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-data-sharing/" title="Data Sharing" class="dd-item 
        
        
        
        ">
      <a href="/4-data-sharing/">
           <b> 4. </b> Data Sharing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-machine-learning---redshift-ml/" title="Machine Learning - Redshift ML" class="dd-item 
        
        
        
        ">
      <a href="/5-machine-learning---redshift-ml/">
           <b> 5. </b> Machine Learning - Redshift ML
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-query-data-lake---redshift-spectrum/" title="Query Data Lake - Redshift Spectrum" class="dd-item 
        
        
        
        ">
      <a href="/6-query-data-lake---redshift-spectrum/">
           <b> 6. </b> Query Data Lake - Redshift Spectrum
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-operations/" title="Operations" class="dd-item 
        
        active
        
        ">
      <a href="/7-operations/">
           <b> 7. </b> Operations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/8-clean/" title="Clean up resources" class="dd-item 
        
        
        
        ">
      <a href="/8-clean/">
           <b> 8. </b> Clean up resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://aws.amazon.com/blogs"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://lingling1101.github.io/7-operations/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://lingling1101.github.io/vi/7-operations/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>31-08-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://drive.google.com/drive/folders/1-JDjxDuFFq9Xwszz7REZ_kDzWDPtM1XS?usp=sharing"  style="color:orange">Nguyễn Thị Thùy Linh  </a> <br>
                
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>Redshift Immersion Labs</a> > Operations
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Operations
            </h1>
          

        



	<p><strong>7. Operations</strong></p>
<p>In this lab, you will go through the monitoring (from both console and system views),audit logging features, changing base RPU setting and limits.</p>
<p><strong>Contents</strong></p>
<ul>
<li>Before you begin</li>
<li>Monitoring</li>
<li>System views</li>
<li>Audit logging</li>
<li>Changing RPUs and setting limits</li>
</ul>
<p><strong>7.1 Before you begin</strong></p>
<p>This lab assumes that you have launched an <strong>Amazon Redshift Serverless</strong> endpoint. If you have not already done so, please see <a href="https://catalog.us-east-1.prod.workshops.aws/workshops/9f29cdba-66c0-445e-8cbb-28a092cb5ba7/en-US/lab1">Getting Started</a> and follow the instructions there. We will use <strong>Amazon Redshift <a href="https://console.aws.amazon.com/sqlworkbench/home">QueryEditorV2</a></strong> and the <a href="https://console.aws.amazon.com/redshiftv2/home?#serverless-dashboard"><strong>Amazon Redshift Serverless</strong></a>  for this lab.</p>
<p><strong>7.2 Monitoring</strong></p>
<p>In this section, you will go through various monitoring options and set filters to experience the functionality. You will use the console to see query history, database performance and resource usage.</p>
<p>Once you’re in the <strong>Redshift Serverless</strong> dashboard, navigate to <a href="https://console.aws.amazon.com/redshiftv2/home?#serverless-query-and-database-monitoring"><strong>Query and database monitoring</strong></a> on the left-hand side menu.</p>
<ul>
<li>Select the <strong>workgroup-xxxxxxx</strong> workgroup</li>
<li>Expand <strong>Additional filtering</strong> options. You can filter these metrics on several categories. Feel free to modify these values based on workload patterns that you are most interested in deciphering. For this lab, set the values as show in the screenshot - these are defaults to start with.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-1.png"></p>
<p>You will not be able to see queries yet. You need to grant monitoring access to your console role. This is a pre-requisite step.</p>
<p>Login as superuser (awsuser) in Query Editor and run below SQL.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Run</span> <span style="color:#a6e22e">below</span> <span style="color:#a6e22e">command</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">running</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">workshop</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">grant</span> <span style="color:#a6e22e">role</span> <span style="color:#a6e22e">sys</span><span style="color:#f92672">:</span><span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">to</span> <span style="color:#e6db74">&#34;IAMR:WSParticipantRole&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span> <span style="color:#a6e22e">Run</span> <span style="color:#a6e22e">below</span> <span style="color:#a6e22e">command</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">running</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">event</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">Event</span> <span style="color:#a6e22e">Engine</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">grant</span> <span style="color:#a6e22e">role</span> <span style="color:#a6e22e">sys</span><span style="color:#f92672">:</span><span style="color:#a6e22e">monitor</span> <span style="color:#a6e22e">to</span> <span style="color:#e6db74">&#34;IAMR:TeamRole&#34;</span> 
</span></span></code></pre></div><ul>
<li>
<p>Now navigate back to the <a href="https://console.aws.amazon.com/redshiftv2/home?#serverless-query-and-database-monitoring"><strong>Query and database monitoring</strong></a>  section on the left-hand side menu and change few filters to start seeing the queries.</p>
</li>
<li>
<p>Scroll below, you can see your query run-times for selected time interval. Use this graph to look into query concurrency as well as to research more into certain queries that took longer to execute than expected.</p>
</li>
</ul>
<p><img alt="image.png" src="/images/7/7-0002.png"></p>
<ul>
<li>Scroll again below to view the Queries and loads chart. Here you can see all the completed, running, and aborted queries.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-03.png"></p>
<p>Navigate to the <strong>Database Performance</strong> tab to view:</p>
<ul>
<li><strong>Queries completed per second</strong>: The average number of queries completed per second</li>
</ul>
<p><img alt="image.png" src="/images/7/7-04.png"></p>
<ul>
<li><strong>Queries duration</strong>: The average amount of time to complete a query</li>
</ul>
<p><img alt="image.png" src="/images/7/7-05.png"></p>
<ul>
<li><strong>Database connections</strong>: The average number of active database connections</li>
</ul>
<p><img alt="image.png" src="/images/7/7-06.png"></p>
<ul>
<li><strong>Running and Queued queries</strong></li>
</ul>
<p><img alt="image.png" src="/images/7/7-07.png"></p>
<p>Navigate to the <strong>Resource Monitoring</strong> section on the left navigation pane.</p>
<ul>
<li>Select the <strong>default workgroup</strong></li>
<li>Expand <strong>Additional filtering</strong> options. Choose <strong>1 minute</strong> time interval and review results. You can also try different ranges to see the results.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-8.png"></p>
<ul>
<li><strong>RPU Capacity Used</strong> - No.of RPUs consumed</li>
</ul>
<p><img alt="image.png" src="/images/7/7-09.png"></p>
<ul>
<li><strong>Compute usage</strong> - RPU seconds</li>
</ul>
<p><img alt="image.png" src="/images/7/7-010.png"></p>
<p><strong>7.3 System Views</strong></p>
<p>Below system views in <strong>Amazon Redshift Serverless</strong> are used to monitor query and workload usage. These views are located in the <strong>pg_catalog</strong> schema. These system views have been designed to give you the information needed to monitor Amazon Redshift Serverless, which are much simpler than various system views available for provisioned clusters.</p>
<ul>
<li>SYS_QUERY_HISTORY</li>
<li>SYS_QUERY_DETAIL</li>
<li>SYS_EXTERNAL_QUERY_DETAIL</li>
<li>SYS_LOAD_HISTORY</li>
<li>SYS_LOAD_ERROR_DETAIL</li>
<li>SYS_UNLOAD_HISTORY</li>
<li>SYS_SERVERLESS_USAGE</li>
</ul>
<p>Please refer to any new additions at <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/serverless-monitoring.html">https://docs.aws.amazon.com/redshift/latest/mgmt/serverless-monitoring.html</a></p>
<p>We will go through some of the frequently used system monitoring queries.</p>
<ul>
<li>Run below query to find the recent 10 completed, running and queued queries</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">user_id</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">query_id</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">transaction_id</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">session_id</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">status</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">trim</span>(<span style="color:#a6e22e">database_name</span>) <span style="color:#a6e22e">AS</span> <span style="color:#a6e22e">database_name</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">start_time</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">end_time</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">result_cache_hit</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">elapsed_time</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">queue_time</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">execution_time</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">sys_query_history</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WHERE</span> <span style="color:#a6e22e">status</span> <span style="color:#a6e22e">IN</span> (<span style="color:#e6db74">&#39;success&#39;</span>,<span style="color:#e6db74">&#39;running&#39;</span>,<span style="color:#e6db74">&#39;queued&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ORDER</span> <span style="color:#a6e22e">BY</span> <span style="color:#a6e22e">start_time</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">LIMIT</span> <span style="color:#ae81ff">10</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/7/7-11.png"></p>
<ul>
<li>Run below query to show serverless usage summary including how much compute capacity is used to process queries and the amount of <strong>Amazon Redshift</strong> managed storage used.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">start_time</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">end_time</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">compute_seconds</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">compute_capacity</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">data_storage</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">sys_serverless_usage</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ORDER</span> <span style="color:#a6e22e">BY</span> <span style="color:#a6e22e">start_time</span> <span style="color:#a6e22e">desc</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/7/7-012.png"></p>
<p>In the result, you can see the periods of idle time where the cluster is auto paused and auto resumed when the queries starts coming in. You will not be charged when the cluster is paused.</p>
<ul>
<li>Query to show the loaded rows, bytes, tables and data source of copy commands</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">query_id</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">table_name</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">data_source</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">loaded_rows</span>,
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">loaded_bytes</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">sys_load_history</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ORDER</span> <span style="color:#a6e22e">BY</span> <span style="color:#a6e22e">query_id</span> <span style="color:#a6e22e">DESC</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/7/7-13.png"></p>
<p><strong>7.4 Audit logging</strong></p>
<p>You can configure Amazon Redshift Serverless to export connection, user, and user-activity log data to a log group in Amazon CloudWatch Logs when creating workgroups</p>
<p>The first step in the process is to make sure audit logging has been enabled for the workgroup.</p>
<ul>
<li>Navigate to <strong>Namespace</strong>→<strong>security and encryption</strong>. Verify audit logging is on.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-014.png"></p>
<p><img alt="image.png" src="/images/7/7-15.png"></p>
<ul>
<li>Select the option <strong>Edit</strong> if Audit logging is disabled and check mark all the 3 options as shown below.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-16.png"></p>
<ul>
<li>Now run following commands in <strong>query editor</strong> connecting to serverless default workgroup</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">create</span> <span style="color:#a6e22e">table</span> <span style="color:#a6e22e">orders_new</span> (
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_ORDERKEY</span> <span style="color:#a6e22e">bigint</span> <span style="color:#a6e22e">NOT</span> <span style="color:#a6e22e">NULL</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_CUSTKEY</span> <span style="color:#a6e22e">bigint</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_ORDERSTATUS</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_TOTALPRICE</span> <span style="color:#a6e22e">decimal</span>(<span style="color:#ae81ff">18</span>,<span style="color:#ae81ff">4</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_ORDERDATE</span> Date,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_ORDERPRIORITY</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">15</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_CLERK</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">15</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_SHIPPRIORITY</span> <span style="color:#a6e22e">Integer</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">O_COMMENT</span> <span style="color:#a6e22e">varchar</span>(<span style="color:#ae81ff">79</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">distkey</span> (<span style="color:#a6e22e">O_ORDERKEY</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sortkey</span> (<span style="color:#a6e22e">O_ORDERDATE</span>);
</span></span></code></pre></div><p><img alt="image.png" src="/images/7/7-017.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">copy</span> <span style="color:#a6e22e">orders_new</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;s3://redshift-immersionday-labs/data/orders/orders.tbl.&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">iam_role</span> <span style="color:#66d9ef">default</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">region</span> <span style="color:#e6db74">&#39;us-west-2&#39;</span> <span style="color:#a6e22e">lzop</span> <span style="color:#a6e22e">delimiter</span> <span style="color:#e6db74">&#39;|&#39;</span> <span style="color:#a6e22e">COMPUPDATE</span> <span style="color:#a6e22e">PRESET</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">orders_new</span> <span style="color:#a6e22e">limit</span> <span style="color:#ae81ff">100</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/7/7-18.png"></p>
<p><img alt="image.png" src="/images/7/7-19.png"></p>
<p>You can monitor events in the Amazon CloudWatch Logs.</p>
<ul>
<li>
<p>Navigate to <strong>Amazon CloudWatch</strong> service and select <strong>Metrics</strong>→<strong>All metrics</strong> on the left navigation menu.</p>
</li>
<li>
<p>Select <strong>AWS/Redshift-Serverless</strong> to get details on Serverless usage. Below is a example screen.</p>
</li>
</ul>
<p><img alt="image.png" src="/images/7/7-020.png"></p>
<p>Amazon Redshift Serverless metrics are divided into groups of compute metrics, data and storage metrics. Select <strong>Workgroup</strong>* to get compute seconds details.</p>
<p><img alt="image.png" src="/images/7/7-21.png"></p>
<p>Select your workgroup to get details on compute resources for the specific workgroup. see below example screen.</p>
<p><img alt="image.png" src="/images/7/7-022.png"></p>
<p>Select <strong>DatabaseName</strong>, <strong>Namespace</strong> to get details on storage resources for a specific namespace as shown below.</p>
<p><img alt="image.png" src="/images/7/7-023.png"></p>
<p>Select <strong>Dev</strong> database for your namespace to find out total number of tables as shown below. Please ensure you de-select all others to see a graph similar to below.</p>
<p><img alt="image.png" src="/images/7/7-0024.png"></p>
<p>You can also export the CloudWatch log groups events to S3. Please see below example screen.</p>
<p><strong>NOTE</strong>: You may not be able to access this in lab environment. But you can try in your own environment.</p>
<p><img alt="image.png" src="/images/7/7-025.png"></p>
<p><strong>7.5 Changing RPUs and Setting limits</strong></p>
<ul>
<li>Select your default workgroup, click on the <strong>Limits</strong> tab.</li>
<li>Click on <strong>Edit</strong> in <strong>Base capacity in Redshift processing units (RPUs)</strong> section.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-26.png"></p>
<p>By default, when you launch your serverless endpoint, you’re provisioned with 128 RPUs. Here you can adjust the <strong>Base capacity</strong> setting from 32 RPUs to 512 RPUs in the incremental units of 8 RPUs. Each RPU, which is a unit of compute resource with 16 GB memory.</p>
<p>For this lab, you can just leave it at 128 RPUs. Select <strong>Cancel</strong>.</p>
<ul>
<li>Scroll down to <strong>Usage limits</strong> and click on <strong>Manage usage limits</strong>.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-27.png"></p>
<ul>
<li>Click on <strong>Add limit</strong>.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-28.png"></p>
<p>In this tab, you can configure usage capacity limits to curb your overall Redshift Serverless bill. To control usage, set the maximum RPU-hours by frequency.</p>
<ul>
<li>Set the <strong>Frequency</strong> to <strong>Daily</strong>, <strong>Usage limit</strong> (hours) to <strong>1</strong>, and <strong>Action</strong> to <strong>Turn off user queries</strong>.</li>
</ul>
<p>(optional) You can set email alerts by selecting <strong>Create SNS topic</strong> to be notified once usage limit as been met. You can park this for home assignment.</p>
<ul>
<li>Once finished, click <strong>Save changes</strong>. After 1 RPU hour of daily usage, your users will no longer be able to send queries to Redshift Serverless and stops any RPU billing.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-29.png"></p>
<ul>
<li>Run the below sample query few times. After few times, it should get usage limit reached error message.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">select</span> <span style="color:#a6e22e">n_name</span>, <span style="color:#a6e22e">s_name</span>, <span style="color:#a6e22e">l_shipmode</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SUM</span>(<span style="color:#a6e22e">L_QUANTITY</span>) <span style="color:#a6e22e">Total_Qty</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">from</span> <span style="color:#a6e22e">lineitem</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">join</span> <span style="color:#a6e22e">supplier</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">l_suppkey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">s_suppkey</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">join</span> <span style="color:#a6e22e">nation</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">s_nationkey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">n_nationkey</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">where</span> <span style="color:#a6e22e">datepart</span>(<span style="color:#a6e22e">year</span>, <span style="color:#a6e22e">L_SHIPDATE</span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1997</span>  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">group</span> <span style="color:#a6e22e">by</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">order</span> <span style="color:#a6e22e">by</span> <span style="color:#ae81ff">3</span> <span style="color:#a6e22e">desc</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/7/7-30.png"></p>
<blockquote>
<p><strong>Tip:</strong> You may want to try removing &ldquo;where&rdquo; condition to avoid fetching results from cache.</p>
</blockquote>
<ul>
<li>You should get an error: <code>ERROR: Query reached usage limit*</code> once you reached the limit and an email notification will be sent if you subscribed through SNS topic.</li>
</ul>
<p><img alt="image.png" src="/images/7/7-31.png"></p>
<p>Go back to <strong>Manage usage limits</strong> and delete the limit before proceeding to the next lab. If you miss this step, you will not able to run queries further.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/6-query-data-lake---redshift-spectrum/" title="Query Data Lake - Redshift Spectrum"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/8-clean/" title="Clean up resources" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1725803905"></script>
    <script src="/js/perfect-scrollbar.min.js?1725803905"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1725803905"></script>
    <script src="/js/jquery.sticky.js?1725803905"></script>
    <script src="/js/featherlight.min.js?1725803905"></script>
    <script src="/js/highlight.pack.js?1725803905"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1725803905"></script>
    <script src="/js/learn.js?1725803905"></script>
    <script src="/js/hugo-learn.js?1725803905"></script>

    <link href="/mermaid/mermaid.css?1725803905" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1725803905"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
