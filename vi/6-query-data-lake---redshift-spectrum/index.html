<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Truy vấn Data Lake - Redshift Spectrum :: LÀM VIỆC VỚI AMAZON SYSTEM MANAGER - SESSION MANAGER</title>

    
    <link href="/css/nucleus.css?1725805070" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1725805070" rel="stylesheet">
    <link href="/css/hybrid.css?1725805070" rel="stylesheet">
    <link href="/css/featherlight.min.css?1725805070" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1725805070" rel="stylesheet">
    <link href="/css/auto-complete.css?1725805070" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1725805070" rel="stylesheet">
    <link href="/css/theme.css?1725805070" rel="stylesheet">
    <link href="/css/hugo-theme.css?1725805070" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1725805070" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1725805070"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/6-query-data-lake---redshift-spectrum/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1725805070"></script>
<script type="text/javascript" src="/js/auto-complete.js?1725805070"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/lingling1101.github.io\/\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1725805070"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-getting-started/" title="Bắt đầu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-getting-started/">
           <b> 1. </b> Bắt đầu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-table-design-and-load/" title="Thiết kế bảng và tải dữ liệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-table-design-and-load/">
           <b> 2. </b> Thiết kế bảng và tải dữ liệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-ongoing-load---elt/" title="Tải dữ liệu liên tục - ELT" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-ongoing-load---elt/">
           <b> 3. </b> Tải dữ liệu liên tục - ELT
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-data-sharing/" title="Chia sẻ dữ liệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-data-sharing/">
           <b> 4. </b> Chia sẻ dữ liệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-machine-learning---redshift-ml/" title="Học máy - Redshift ML" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-machine-learning---redshift-ml/">
           <b> 5. </b> Học máy - Redshift ML
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-query-data-lake---redshift-spectrum/" title="Truy vấn Data Lake - Redshift Spectrum" class="dd-item 
        
        active
        
        ">
      <a href="/vi/6-query-data-lake---redshift-spectrum/">
          <b>6. </b>Truy vấn Data Lake - Redshift Spectrum
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/7-operations/" title="Các hoạt động" class="dd-item 
        
        
        
        ">
      <a href="/vi/7-operations/">
          <b>7. </b>Các hoạt động
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/8-clean/" title="Xóa các tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/vi/8-clean/">
          <b>8. </b>Xóa các tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://lingling1101.github.io/6-query-data-lake---redshift-spectrum/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://lingling1101.github.io/vi/6-query-data-lake---redshift-spectrum/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>31-08-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://drive.google.com/drive/folders/1-JDjxDuFFq9Xwszz7REZ_kDzWDPtM1XS?usp=sharing"  style="color:orange">Nguyễn Thị Thùy Linh  </a> <br>
                
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/vi/'>Redshift Immersion Labs</a> > Truy vấn Data Lake - Redshift Spectrum
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Truy vấn Data Lake - Redshift Spectrum
            </h1>
          

        



	<p><strong>6. Truy vấn Data Lake - Redshift Spectrum</strong></p>
<p>Trong bài thực hành này, chúng tôi sẽ hướng dẫn bạn cách truy vấn dữ liệu trong Amazon S3 Data Lake bằng Amazon Redshift mà không cần tải hoặc di chuyển dữ liệu. Chúng tôi cũng sẽ trình bày cách bạn có thể sử dụng các view để kết hợp dữ liệu trong Redshift Managed storage với dữ liệu trong S3. Bạn có thể truy vấn dữ liệu có cấu trúc và bán cấu trúc từ các tệp trong Amazon S3 mà không cần sao chép hoặc di chuyển dữ liệu vào các bảng của Amazon Redshift.</p>
<p><img alt="image.png" src="/images/6/6-001.png"></p>
<p><strong>Nội dung</strong></p>
<ul>
<li>Trước khi bắt đầu</li>
<li>Mô tả trường hợp sử dụng</li>
<li>Hướng dẫn</li>
<li>Trước khi kết thúc</li>
</ul>
<p><strong>6.1 Trước khi bắt đầu</strong></p>
<p>Bài thực hành này giả định rằng bạn đã khởi tạo một Redshift Serverless Warehouse. Nếu bạn chưa tạo Redshift Serverless Warehouse, hãy xem phần <a href="https://catalog.us-east-1.prod.workshops.aws/workshops/9f29cdba-66c0-445e-8cbb-28a092cb5ba7/en-US/lab1">Bắt Đầu</a>. Chúng tôi sẽ sử dụng Redshift Query Editor V2 trong bảng điều khiển Redshift cho bài thực hành này.</p>
<p>Vui lòng tìm khu vực của bạn bằng cách làm theo hình ảnh bên dưới và chọn bộ dữ liệu s3 theo hướng dẫn cho khu vực của bạn.</p>
<blockquote>
<p>Phòng thí nghiệm này yêu cầu không gian tên Redshift Serverless trong các vùng us-east-1(N. Virginia) hoặc us-west-2(Oregon) hoặc eu-west-1(Ireland) hoặc ap-northeast-1(Tokyo) vì dữ liệu trong s3 nằm ở bốn vùng này.</p>
</blockquote>
<p><strong>6.2 Mô tả trường hợp sử dụng</strong></p>
<p><strong>Mục tiêu</strong>: Rút ra những thông tin dữ liệu để thể hiện tác động của trận bão tuyết đến số lượng chuyến xe taxi vào tháng 1 năm 2016.</p>
<p><strong>Mô tả tập dữ liệu</strong>: Dữ liệu chuyến đi taxi tại thành phố New York bao gồm số lượng chuyến đi taxi theo năm và tháng cho 3 công ty taxi khác nhau - fhv, green, và yellow.</p>
<p><strong>Vị trí tập dữ liệu trên S3</strong>:</p>
<ul>
<li>Khu vực <strong>us-east-1</strong> - <a href="https://s3.console.aws.amazon.com/s3/buckets/redshift-demos?region=us-east-1&prefix=data/NY-Pub/">https://s3.console.aws.amazon.com/s3/buckets/redshift-demos?region=us-east-1&amp;prefix=data/NY-Pub/</a></li>
<li>Khu vực <strong>us-west-2</strong> - <a href="https://s3.console.aws.amazon.com/s3/buckets/us-west-2.serverless-analytics?prefix=canonical/NY-Pub/">https://s3.console.aws.amazon.com/s3/buckets/us-west-2.serverless-analytics?prefix=canonical/NY-Pub/</a></li>
<li>Khu vực <strong>eu-west-1</strong> - <a href="https://s3.console.aws.amazon.com/s3/buckets/redshift-demos-dub?region=eu-west-1&prefix=NY-Pub/">https://s3.console.aws.amazon.com/s3/buckets/redshift-demos-dub?region=eu-west-1&amp;prefix=NY-Pub/</a></li>
<li>Khu vực <strong>ap-northeast-1</strong> - <a href="https://s3.console.aws.amazon.com/s3/buckets/redshift-demos-nrt?region=ap-northeast-1&prefix=NY-Pub/">https://s3.console.aws.amazon.com/s3/buckets/redshift-demos-nrt?region=ap-northeast-1&amp;prefix=NY-Pub/</a></li>
</ul>
<p>Dưới đây là tổng quan về các bước trong trường hợp sử dụng này liên quan đến bài thực hành.
<img alt="image.png" src="/images/6/6-2.png"></p>
<p><strong>6.3 Hướng dẫn</strong></p>
<p><strong>1. Tạo và chạy Glue crawler để điền vào Glue data catalog</strong></p>
<p>Trong phần này của bài thực hành, chúng ta sẽ thực hiện các hoạt động sau:</p>
<ul>
<li>Truy vấn dữ liệu lịch sử lưu trữ trên S3 bằng cách tạo một cơ sở dữ liệu (DB) ngoài cho Redshift Spectrum.</li>
<li>Xem xét kỹ dữ liệu lịch sử, có thể tổng hợp dữ liệu theo những cách mới để xem các xu hướng theo thời gian hoặc các khía cạnh khác.</li>
<li>Lưu ý rằng lược đồ phân vùng là Năm, Tháng, Loại (trong đó Loại là công ty taxi). Dưới đây là ảnh chụp màn hình: <a href="https://s3.console.aws.amazon.com/s3/buckets/us-west-2.serverless-analytics/canonical/NY-Pub/">https://s3.console.aws.amazon.com/s3/buckets/us-west-2.serverless-analytics/canonical/NY-Pub/</a></li>
</ul>
<blockquote>
<p>Region</p>
<p>Nhấp vào liên kết ở trên có thể thay đổi vùng mặc định của bạn. Khi tiếp tục các bước tiếp theo, hãy đảm bảo vùng của bạn là chính xác trước khi tạo Glue Crawler.</p>
</blockquote>
<p><img alt="image.png" src="/images/6/6-03.png"></p>
<p><strong>Tạo lược đồ (và cơ sở dữ liệu) ngoài cho Redshift Spectrum</strong></p>
<p>Bạn có thể tạo một bảng ngoài trong Amazon Redshift, AWS Glue, Amazon Athena, hoặc một Apache Hive metastore. Nếu bảng ngoài của bạn được định nghĩa trong AWS Glue, Athena, hoặc một Hive metastore, trước tiên bạn cần tạo một lược đồ ngoài tham chiếu đến cơ sở dữ liệu ngoài. Sau đó, bạn có thể tham chiếu bảng ngoài trong câu lệnh SELECT của mình bằng cách thêm tiền tố tên bảng với tên lược đồ mà không cần phải tạo bảng trong Amazon Redshift.</p>
<p>Trong bài thực hành này, bạn sẽ sử dụng AWS Glue Crawler để tạo bảng ngoài <strong>adb305.ny_pub</strong> được lưu trữ dưới định dạng <strong>parquet</strong> trong vị trí S3 của khu vực tương ứng.</p>
<p><strong>+ Điều hướng đến Trang Glue Crawler:</strong></p>
<ul>
<li>Khu vực <strong>us-east-1</strong> - <a href="https://us-east-1.console.aws.amazon.com/glue/home">https://us-east-1.console.aws.amazon.com/glue/home</a></li>
<li>Khu vực <strong>us-west-2</strong> - <a href="https://us-west-2.console.aws.amazon.com/glue/home">https://us-west-2.console.aws.amazon.com/glue/home</a></li>
<li>Khu vực <strong>eu-west-1</strong> - <a href="https://eu-west-1.console.aws.amazon.com/glue/home">https://eu-west-1.console.aws.amazon.com/glue/home</a></li>
<li>Khu vực <strong>ap-northeast-1</strong> - <a href="https://ap-northeast-1.console.aws.amazon.com/glue/home">https://ap-northeast-1.console.aws.amazon.com/glue/home</a></li>
</ul>
<p><img alt="image.png" src="/images/6/6-4.png"></p>
<p><strong>+</strong> Nhấp vào <strong>Create Crawler</strong>, nhập tên crawler là <strong>NYTaxiCrawler</strong> và nhấp <strong>Next</strong>.</p>
<p><img alt="image.png" src="/images/6/6-5.png"></p>
<p><strong>+</strong> Chọn <strong>Add a data source.</strong></p>
<p><img alt="image.png" src="/images/6/6-6.png"></p>
<p><strong>+</strong> Chọn <strong>S3</strong> làm nguồn dữ liệu.</p>
<p><strong>+</strong> Chọn <strong>In a different account</strong> (Trong một tài khoản khác)</p>
<p><strong>+</strong> Nhập đường dẫn tệp S3:</p>
<ul>
<li>Đối với khu vực <strong>us-east-1</strong> - <code>s3://redshift-demos/data/NY-Pub/</code></li>
<li>Đối với khu vực <strong>us-west-2</strong> - <code>s3://us-west-2.serverless-analytics/canonical/NY-Pub/</code></li>
<li>Đối với khu vực <strong>eu-west-1</strong> - <code>s3://redshift-demos-dub/NY-Pub/</code></li>
<li>Đối với khu vực <strong>ap-northeast-1</strong> - <code>s3://redshift-demos-nrt/NY-Pub/</code></li>
</ul>
<p><strong>+</strong> Nhấp vào <strong>Add an S3 data source</strong> (Thêm một nguồn dữ liệu S3).</p>
<p><img alt="image.png" src="/images/6/6-7.png"></p>
<p><strong>+</strong> Nhấn <strong>Next</strong></p>
<p><img alt="image.png" src="/images/6/6-8.png"></p>
<p><strong>+</strong> Nhấp vào <strong>Create new IAM role</strong> và nhấp <strong>Next</strong></p>
<p><img alt="image.png" src="/images/6/6-9.png"></p>
<p><strong>+</strong> Nhập tên <strong>AWSGlueServiceRole-RedshiftImmersion</strong> và nhấp <strong>Create</strong></p>
<p><img alt="image.png" src="/images/6/6-10.png"></p>
<p><strong>+</strong> Nhấp vào <strong>Add database</strong> và nhập tên là <strong>spectrumdb</strong></p>
<p><img alt="image.png" src="/images/6/6-11.png"></p>
<p><img alt="image.png" src="/images/6/6-012.png"></p>
<p><strong>+</strong> Quay lại <strong>Glue Console</strong>, làm mới cơ sở dữ liệu đích và chọn <strong>spectrumdb</strong></p>
<p><img alt="image.png" src="/images/6/6-13.png"></p>
<p><strong>+</strong> Chọn tất cả các tùy chọn mặc định còn lại và nhấp <strong>Create crawler</strong>. Chọn crawler <strong>NYTaxiCrawler</strong> và nhấp <strong>Run</strong>.</p>
<p><img alt="image.png" src="/images/6/6-14.png"></p>
<p><strong>+</strong> Sau khi quá trình chạy crawler hoàn tất, bạn có thể thấy một bảng mới <strong>ny_pub</strong> trong <strong>Glue Catalog</strong>.</p>
<p><img alt="image.png" src="/images/6/6-015.png"></p>
<p><strong>2. Tạo lược đồ ngoài adb305 trong Redshift và truy vấn từ bảng trong Glue catalog - ny_pub</strong></p>
<p><strong>+</strong> Đi đến <strong>Redshift console</strong>:</p>
<ul>
<li>Khu vực <strong>us-east-1</strong> - <a href="https://us-east-1.console.aws.amazon.com/redshiftv2/home?region=us-east-1#/serverless-setup">https://us-east-1.console.aws.amazon.com/redshiftv2/home?region=us-east-1#/serverless-setup</a></li>
<li>Khu vực <strong>us-west-2</strong> - <a href="https://us-west-2.console.aws.amazon.com/redshiftv2/home?region=us-west-2#/serverless-setup">https://us-west-2.console.aws.amazon.com/redshiftv2/home?region=us-west-2#/serverless-setup</a></li>
<li>Khu vực <strong>eu-west-1</strong> - <a href="https://eu-west-1.console.aws.amazon.com/redshiftv2/home?region=eu-west-1#/serverless-setup">https://eu-west-1.console.aws.amazon.com/redshiftv2/home?region=eu-west-1#/serverless-setup</a></li>
<li>Khu vực <strong>ap-northeast-1</strong> - <a href="https://ap-northeast-1.console.aws.amazon.com/redshiftv2/home?region=ap-northeast-1#/serverless-setup">https://ap-northeast-1.console.aws.amazon.com/redshiftv2/home?region=ap-northeast-1#/serverless-setup</a></li>
</ul>
<p>Nhấp vào mục <strong>Serverless dashboard</strong> ở bên trái của bảng điều khiển. Nhấp vào không gian tên đã được cung cấp trước đó. Nhấp vào <strong>Query data</strong>.</p>
<p><img alt="image.png" src="/images/6/6-016.png"></p>
<ul>
<li>Tạo một lược đồ ngoài <strong>adb305</strong> trỏ đến cơ sở dữ liệu <strong>Glue Catalog</strong> của bạn là <strong>spectrumdb</strong>.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">external</span> <span style="color:#a6e22e">SCHEMA</span> <span style="color:#a6e22e">adb305</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">catalog</span> <span style="color:#a6e22e">DATABASE</span> <span style="color:#e6db74">&#39;spectrumdb&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">IAM_ROLE</span> <span style="color:#66d9ef">default</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">external</span> <span style="color:#a6e22e">DATABASE</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">exists</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-017.png"></p>
<p><strong>Pin-point the Blizzard</strong></p>
<p>Bạn có thể truy vấn bảng <strong>ny_pub</strong>, được định nghĩa trong <strong>Glue Catalog</strong> từ lược đồ ngoài <strong>Redshift</strong>. Vào tháng 1 năm 2016, có một ngày có số lượng chuyến đi taxi thấp nhất do bão tuyết. Bạn có thể tìm ngày đó không?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">TO_CHAR</span>(<span style="color:#a6e22e">pickup_datetime</span>, <span style="color:#e6db74">&#39;YYYY-MM-DD&#39;</span>),<span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">adb305</span>.<span style="color:#a6e22e">ny_pub</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WHERE</span> <span style="color:#a6e22e">YEAR</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2016</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">Month</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">01</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">GROUP</span> <span style="color:#a6e22e">BY</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ORDER</span> <span style="color:#a6e22e">BY</span> <span style="color:#ae81ff">2</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-18.png"></p>
<p><strong>3. Tạo lược đồ nội bộ workshop_das</strong></p>
<p>Tạo một lược đồ <strong>workshop_das</strong> cho các bảng sẽ được lưu trữ trên <strong>Redshift Managed Storage</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">SCHEMA</span> <span style="color:#a6e22e">workshop_das</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-19.png"></p>
<p><strong>4. Chạy CTAS để tạo và tải bảng Redshift workshop_das.taxi_201601 bằng cách chọn từ bảng ngoài</strong></p>
<p>Tạo bảng <strong>workshop_das.taxi_201601</strong> để tải dữ liệu cho công ty taxi <strong>green</strong> vào tháng 1 năm 2016</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#a6e22e">workshop_das</span>.<span style="color:#a6e22e">taxi_201601</span> <span style="color:#a6e22e">AS</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">adb305</span>.<span style="color:#a6e22e">ny_pub</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WHERE</span> <span style="color:#a6e22e">year</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2016</span> <span style="color:#a6e22e">AND</span> <span style="color:#a6e22e">month</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">AND</span> <span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;green&#39;</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-20.png"></p>
<p><strong>Lưu ý</strong>: Còn về nén/ mã hóa cột thì sao? Hãy nhớ rằng trên một CTAS, Amazon Redshift tự động chỉ định mã hóa nén như sau:</p>
<ul>
<li>Các cột được định nghĩa là khóa sắp xếp được chỉ định mã hóa RAW.</li>
<li>Các cột được định nghĩa là BOOLEAN, REAL, DOUBLE PRECISION, hoặc GEOMETRY được chỉ định mã hóa RAW.</li>
<li>Các cột được định nghĩa là SMALLINT, INTEGER, BIGINT, DECIMAL, DATE, TIMESTAMP, hoặc TIMESTAMPTZ được chỉ định mã hóa AZ64.</li>
<li>Các cột được định nghĩa là CHAR hoặc VARCHAR được chỉ định mã hóa LZO.
<a href="https://docs.aws.amazon.com/redshift/latest/dg/r_CTAS_usage_notes.html">https://docs.aws.amazon.com/redshift/latest/dg/r_CTAS_usage_notes.html</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">ANALYZE</span> <span style="color:#a6e22e">COMPRESSION</span> <span style="color:#a6e22e">workshop_das</span>.<span style="color:#a6e22e">taxi_201601</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-021.png"></p>
<ul>
<li>Thêm vào bảng <strong>taxi_201601</strong> với câu lệnh <strong>INSERT/SELECT</strong> cho các công ty taxi khác.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">INSERT</span> <span style="color:#a6e22e">INTO</span> <span style="color:#a6e22e">workshop_das</span>.<span style="color:#a6e22e">taxi_201601</span> (
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">adb305</span>.<span style="color:#a6e22e">ny_pub</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WHERE</span> <span style="color:#a6e22e">year</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2016</span> <span style="color:#a6e22e">AND</span> <span style="color:#a6e22e">month</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">AND</span> <span style="color:#a6e22e">type</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;green&#39;</span>);
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-22.png"></p>
<p><strong>5. Xóa các phân vùng 201601 khỏi bảng ngoài</strong></p>
<p>Bây giờ chúng ta đã tải xong dữ liệu của tháng 1 năm 2016, chúng ta có thể xóa các phân vùng khỏi bảng Spectrum để không có sự trùng lặp giữa bảng <strong>Redshift Managed Storage (RMS)</strong> và bảng <strong>Spectrum</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">ALTER</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#a6e22e">adb305</span>.<span style="color:#a6e22e">ny_pub</span> <span style="color:#a6e22e">DROP</span> <span style="color:#a6e22e">PARTITION</span>(<span style="color:#a6e22e">year</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2016</span>, <span style="color:#a6e22e">month</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fhv&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ALTER</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#a6e22e">adb305</span>.<span style="color:#a6e22e">ny_pub</span> <span style="color:#a6e22e">DROP</span> <span style="color:#a6e22e">PARTITION</span>(<span style="color:#a6e22e">year</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2016</span>, <span style="color:#a6e22e">month</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;green&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ALTER</span> <span style="color:#a6e22e">TABLE</span> <span style="color:#a6e22e">adb305</span>.<span style="color:#a6e22e">ny_pub</span> <span style="color:#a6e22e">DROP</span> <span style="color:#a6e22e">PARTITION</span>(<span style="color:#a6e22e">year</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2016</span>, <span style="color:#a6e22e">month</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;yellow&#39;</span>);
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-23.png"></p>
<p><strong>6. Tạo view kết hợp public.adb305_view_NY_TaxiRides</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">CREATE</span> <span style="color:#a6e22e">VIEW</span> <span style="color:#a6e22e">adb305_view_NYTaxiRides</span> <span style="color:#a6e22e">AS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">workshop_das</span>.<span style="color:#a6e22e">taxi_201601</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">UNION</span> <span style="color:#a6e22e">ALL</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">adb305</span>.<span style="color:#a6e22e">ny_pub</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WITH</span> <span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">SCHEMA</span> <span style="color:#a6e22e">BINDING</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-024.png"></p>
<p><strong>Giải thích hiển thị kế hoạch thực thi cho một câu lệnh truy vấn mà không chạy truy vấn</strong></p>
<ul>
<li>Lưu ý việc sử dụng các cột phân vùng trong câu lệnh SELECT và WHERE. Các cột đó nằm ở đâu trong định nghĩa bảng Spectrum của bạn?</li>
<li>Lưu ý các bộ lọc được áp dụng ở mức phân vùng hoặc tệp trong tập dữ liệu Spectrum của truy vấn (so với tập dữ liệu Redshift Managed Storage).</li>
<li>Nếu bạn thực sự chạy truy vấn (và không chỉ tạo kế hoạch giải thích), thời gian chạy có làm bạn ngạc nhiên không? Tại sao hoặc tại sao không?</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">EXPLAIN</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">SELECT</span> <span style="color:#a6e22e">year</span>, <span style="color:#a6e22e">month</span>, <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">COUNT</span>(<span style="color:#f92672">*</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">FROM</span> <span style="color:#a6e22e">adb305_view_NYTaxiRides</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WHERE</span> <span style="color:#a6e22e">year</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2016</span> <span style="color:#a6e22e">AND</span> <span style="color:#a6e22e">month</span> <span style="color:#a6e22e">IN</span> (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>) <span style="color:#a6e22e">AND</span> <span style="color:#a6e22e">passenger_count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">GROUP</span> <span style="color:#a6e22e">BY</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span> <span style="color:#a6e22e">ORDER</span> <span style="color:#a6e22e">BY</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>;
</span></span></code></pre></div><p><img alt="image.png" src="/images/6/6-25.png"></p>
<p><img alt="image.png" src="/images/6/6-026.png"></p>
<p>Lưu ý rằng <strong>S3 Seq Scan</strong> đã được thực hiện trên dữ liệu trên Amazon S3. Node <strong>S3 Seq Scan</strong> cho thấy bộ lọc: (passenger_count = 4) đã được xử lý trong lớp <strong>Redshift Spectrum</strong>.</p>
<p>Để cải thiện hiệu suất Redshift Spectrum, vui lòng tham khảo <a href="https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-performance.html">https://docs.aws.amazon.com/redshift/latest/dg/c-spectrum-external-performance.html</a></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/5-machine-learning---redshift-ml/" title="Học máy - Redshift ML"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/7-operations/" title="Các hoạt động" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1725805070"></script>
    <script src="/js/perfect-scrollbar.min.js?1725805070"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1725805070"></script>
    <script src="/js/jquery.sticky.js?1725805070"></script>
    <script src="/js/featherlight.min.js?1725805070"></script>
    <script src="/js/highlight.pack.js?1725805070"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1725805070"></script>
    <script src="/js/learn.js?1725805070"></script>
    <script src="/js/hugo-learn.js?1725805070"></script>

    <link href="/mermaid/mermaid.css?1725805070" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1725805070"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
